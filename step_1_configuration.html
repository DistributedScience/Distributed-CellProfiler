

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Step 1: Configuration &#8212; DCP Documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'step_1_configuration';</script>
    <link rel="canonical" href="distributedscience.github.io/step_1_configuration.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="config.py configuration examples" href="config_examples.html" />
    <link rel="prev" title="Step 0: Prep" href="step_0_prep.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="overview.html">
  
  
  
  
  
  
    <p class="title logo__title">DCP Documentation</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="overview.html">
                    What is Distributed-CellProfiler?
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">FAQ</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="overview_2.html">What happens in AWS when I run Distributed-CellProfiler?</a></li>
<li class="toctree-l1"><a class="reference internal" href="costs.html">What does Distributed-CellProfiler cost?</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Running DCP</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="step_0_prep.html">Step 0: Prep</a></li>
<li class="toctree-l1 current active has-children"><a class="current reference internal" href="#">Step 1: Configuration</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="config_examples.html">config.py configuration examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="SQS_QUEUE_information.html">SQS QUEUE Information</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="step_2_submit_jobs.html">Step 2: Submit Jobs</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="passing_files_to_DCP.html">Passing Files to DCP</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="step_3_start_cluster.html">Step 3: Start Cluster</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting_start_cluster.html">Troubleshooting startCluster</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="step_4_monitor.html">Step 4: Monitor</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Technical Guides</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="dashboard.html">AWS Cloudwatch Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="external_buckets.html">Using External Buckets</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced_configuration.html">Advanced Configuration of DCP</a></li>
<li class="toctree-l1"><a class="reference internal" href="AWS_hygiene_scripts.html">AWS Hygiene Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting_runs.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="versions.html">Versions</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/distributedscience/distributed-cellprofiler" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/distributedscience/distributed-cellprofiler/edit/main/DCP-documentation/step_1_configuration.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/distributedscience/distributed-cellprofiler/issues/new?title=Issue%20on%20page%20%2Fstep_1_configuration.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/step_1_configuration.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Step 1: Configuration</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#components-of-the-config-file">Components of the config file</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#aws-general-settings">AWS GENERAL SETTINGS</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ec2-and-ecs-information">EC2 AND ECS INFORMATION</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#docker-instance-running-environment">DOCKER INSTANCE RUNNING ENVIRONMENT</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sqs-queue-information">SQS QUEUE INFORMATION</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#log-group-information">LOG GROUP INFORMATION</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#monitoring">MONITORING</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cloudwatch-dashboard-creation">CLOUDWATCH DASHBOARD CREATION</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#redundancy-checks">REDUNDANCY CHECKS</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cellprofiler-settings">CELLPROFILER SETTINGS</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plugins">PLUGINS</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-configurations">EXAMPLE CONFIGURATIONS</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="step-1-configuration">
<h1>Step 1: Configuration<a class="headerlink" href="#step-1-configuration" title="Permalink to this heading">#</a></h1>
<p>The first step in setting up any job is editing the values in the config.py file.
Once the config file is created, simply type <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">run.py</span> <span class="pre">setup</span></code> to set up your resources based on the configurations you’ve specified.</p>
<hr class="docutils" />
<section id="components-of-the-config-file">
<h2>Components of the config file<a class="headerlink" href="#components-of-the-config-file" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>APP_NAME:</strong> This will be used to tie your clusters, tasks, services, logs, and alarms together.
It need not be unique, but it should be descriptive enough that you can tell jobs apart if you’re running multiple analyses (i.e. “NuclearSegmentation_Drosophila” is better than “CellProfiler”).</p></li>
</ul>
<hr class="docutils" />
<ul class="simple">
<li><p><strong>DOCKERHUB_TAG:</strong> This is the encapsulated version of your software your analyses will be running.</p></li>
</ul>
<hr class="docutils" />
<section id="aws-general-settings">
<h3>AWS GENERAL SETTINGS<a class="headerlink" href="#aws-general-settings" title="Permalink to this heading">#</a></h3>
<p>These are settings that will allow your instances to be configured correctly and access the resources they need- see <a class="reference internal" href="step_0_prep.html"><span class="doc std std-doc">Step 0: Prep</span></a> for more information.</p>
<p>Bucket configurations allow you to read/write from/to different bucket in different accounts from where you are running DCP.
If you are not accessing any external buckets, set AWS_BUCKET, SOURCE_BUCKET, and DESTINATION_BUCKET the same.
For more information and examples, see <a class="reference internal" href="external_buckets.html"><span class="doc std std-doc">External Buckets</span></a>.</p>
<ul class="simple">
<li><p><strong>AWS_BUCKET:</strong> The bucket to which you would like to write log files.
This is generally the bucket in the account in which you are running compute.</p></li>
<li><p><strong>SOURCE_BUCKET:</strong> The bucket where the image files you will be reading are.
Often, this is the same as AWS_BUCKET.</p></li>
<li><p><strong>WORKSPACE:</strong> The bucket where non-image files you will be reading are (e.g. pipeline, load_data.csv, etc.).
Often, this is the same as AWS_BUCKET.</p></li>
<li><p><strong>DESTINATION_BUCKET:</strong> The bucket where you want to write your output files.
Often, this is the same as AWS_BUCKET.</p></li>
<li><p><strong>UPLOAD_FLAGS:</strong> If you need to add flags to an AWS CLI command to upload flags to your DESTINATION_BUCKET, this is where you enter them.
This is typically only used if you are writing to a bucket that is not yours.
If you don’t need to add UPLOAD_FLAGS, keep it as the default ‘’.</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="ec2-and-ecs-information">
<h3>EC2 AND ECS INFORMATION<a class="headerlink" href="#ec2-and-ecs-information" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>ECS_CLUSTER:</strong> Which ECS cluster you’d like the jobs to go into.
All AWS accounts come with a “default” cluster, but you may add more clusters if you like.
Distinct clusters for each job are not necessary, but if you’re running multiple analyses at once it can help avoid the wrong Docker containers (such as the ones for your “NuclearSegmentation_Drosophila” job) going to the wrong instances (such as the instances that are part of your “NuclearSegmentation_HeLa” spot fleet).</p></li>
<li><p><strong>CLUSTER_MACHINES:</strong> How many EC2 instances you want to have in your cluster.</p></li>
<li><p><strong>TASKS_PER_MACHINE:</strong> How many Docker containers to place on each machine.</p></li>
<li><p><strong>MACHINE_TYPE:</strong> A list of what type(s) of machines your spot fleet should contain.</p></li>
<li><p><strong>MACHINE_PRICE:</strong> How much you’re willing to pay per hour for each machine launched.
AWS has a handy <a class="reference external" href="https://console.aws.amazon.com/ec2sp/v1/spot/home">price history tracker</a> you can use to make a reasonable estimate of how much to bid.
If your jobs complete quickly and/or you don’t need the data immediately you can reduce your bid accordingly; jobs that may take many hours to finish or that you need results from immediately may justify a higher bid.
See also <a class="reference external" href="https://aws.amazon.com/ec2/pricing/on-demand/">AWS on-demand pricing</a> to compare the cost savings of using spot fleets.</p></li>
<li><p><strong>EBS_VOL_SIZE:</strong> The size of the temporary hard drive associated with each EC2 instance in GB.
The minimum allowed is 22.
If you have multiple Dockers running per machine, each Docker will have access to (EBS_VOL_SIZE/TASKS_PER_MACHINE)- 2 GB of space.</p></li>
<li><p><strong>DOWNLOAD_FILES:</strong> Whether or not to download the image files to the EBS volume before processing, as opposed to accessing them all from S3FS.
This typically requires a larger EBS volume (depending on the size of your image sets, and how many sets are processed per group), but avoids occasional issues with S3FS that can crop up on longer runs.
By default, DCP uses S3FS to mount the S3 <code class="docutils literal notranslate"><span class="pre">SOURCE_BUCKET</span></code> as a pseudo-file system on each EC2 instance in your spot fleet to avoid file download.
If you are unable to mount the <code class="docutils literal notranslate"><span class="pre">SOURCE_BUCKET</span></code> (perhaps because of a permissions issue) you should proceed with <code class="docutils literal notranslate"><span class="pre">DOWNLOAD_FILES</span> <span class="pre">=</span> <span class="pre">'True'</span></code>.</p></li>
<li><p><strong>ASSIGN_IP:</strong> Whether or not to assign an a public IPv4 address to each instance in the spot fleet.
If set to ‘False’ will overwrite whatever is in the Fleet file.
If set to ‘True’ will respect whatever is in the Fleet file.
Distributed-CellProfiler originally defaulted to assign an IP address to each instance so that one could connect to the instance for troubleshooting but that need has been mostly obviated by the level of logging currently in DCP.</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="docker-instance-running-environment">
<h3>DOCKER INSTANCE RUNNING ENVIRONMENT<a class="headerlink" href="#docker-instance-running-environment" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>DOCKER_CORES:</strong> How many copies of your script to run in each Docker container.</p></li>
<li><p><strong>CPU_SHARES:</strong> How many CPUs each Docker container may have.</p></li>
<li><p><strong>MEMORY:</strong> How much memory each Docker container may have.</p></li>
<li><p><strong>SECONDS_TO_START:</strong> The time each Docker core will wait before it starts another copy of your software.
This can safely be set to 0 for workflows that don’t require much memory or execute quickly; for slower and/or more memory intensive pipelines we advise you to space them out by roughly the length of your most memory intensive step to make sure your software doesn’t crash due to lack of memory.</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="sqs-queue-information">
<h3>SQS QUEUE INFORMATION<a class="headerlink" href="#sqs-queue-information" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>SQS_QUEUE_NAME:</strong> The name of the queue where all of your jobs will be sent.</p></li>
<li><p><strong>SQS_MESSAGE_VISIBILITY:</strong> How long each job is hidden from view before being allowed to be tried again.
We recommend setting this to slightly longer than the average amount of time it takes an individual job to process- if you set it too short, you may waste resources doing the same job multiple times; if you set it too long, your instances may have to wait around a long while to access a job that was sent to an instance that stalled or has since been terminated.</p></li>
<li><p><strong>SQS_DEAD_LETTER_QUEUE:</strong> The name of the queue to send jobs to if they fail to process correctly multiple times; this keeps a single bad job (such as one where a single file has been corrupted) from keeping your cluster active indefinitely.
This queue will be automatically made if it doesn’t exist already.
See <span class="xref myst">Step 0: Prep</span> for more information.</p></li>
<li><p><strong>JOB_RETRIES:</strong> This is the number of times that a job will be retried before it is sent to the Dead Letter Queue.</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="log-group-information">
<h3>LOG GROUP INFORMATION<a class="headerlink" href="#log-group-information" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>LOG_GROUP_NAME:</strong> The name to give the log group that will monitor the progress of your jobs and allow you to check performance or look for problems after the fact.</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="monitoring">
<h3>MONITORING<a class="headerlink" href="#monitoring" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>AUTO_MONITOR:</strong> Whether or not to have Auto-Monitor automatically monitor your jobs.</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="cloudwatch-dashboard-creation">
<h3>CLOUDWATCH DASHBOARD CREATION<a class="headerlink" href="#cloudwatch-dashboard-creation" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>CREATE_DASHBOARD:</strong> Create a Cloudwatch Dashboard that plots run metrics?</p></li>
<li><p><strong>CLEAN_DASHBOARD:</strong> Automatically clean up the Cloudwatch Dashboard at the end of the run?</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="redundancy-checks">
<h3>REDUNDANCY CHECKS<a class="headerlink" href="#redundancy-checks" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>CHECK_IF_DONE_BOOL:</strong> Whether or not to check the output folder before proceeding.
Case-insensitive.
If an analysis fails partway through (due to some of the files being in the wrong place, an AWS outage, a machine crash, etc.), setting this to ‘True’ this allows you to resubmit the whole analysis but only reprocess jobs that haven’t already been done.
This saves you from having to try to parse exactly which jobs succeeded vs failed or from having to pay to rerun the entire analysis.
If your software determines the correct number of files are already in the output folder it will designate that job as completed and move onto the next one.
If you actually do want to overwrite files that were previously generated (such as when you have improved a pipeline and no longer want the output of the old version), set this to ‘False’ to process jobs whether or not there are already files in the output folder.</p></li>
<li><p><strong>EXPECTED_NUMBER_FILES:</strong> How many files need to be in the output folder in order to mark a job as completed.</p></li>
<li><p><strong>MIN_FILE_SIZE_BYTES:</strong> What is the minimal number of bytes an object should be to “count”?
Useful when trying to detect jobs that may have exported smaller corrupted files vs larger, full-size files.</p></li>
<li><p><strong>NECESSARY_STRING:</strong> This allows you to optionally set a string that must be included in your file to count towards the total in EXPECTED_NUMBER_FILES.</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="cellprofiler-settings">
<h3>CELLPROFILER SETTINGS<a class="headerlink" href="#cellprofiler-settings" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>ALWAYS CONTINUE:</strong> Whether or not to run CellProfiler with the –always-continue flag, which will keep CellProfiler from crashing if it errors.
Use with caution.
This can be particularly helpful in jobs where a large number of files are loaded in a single run (such as during illumination correction) so that a corrupted or missing file doesn’t prevent the whole job completing.
However, this can make it harder to notice jobs that are not completely succesffully so should be used with caution.
We suggest using this setting in conjunction with a small number of JOB_RETRIES.</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="plugins">
<h3>PLUGINS<a class="headerlink" href="#plugins" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>USE_PLUGINS:</strong> Whether or not you will be using external plugins from the CellProfiler-plugins repository.
When True, passes the <code class="docutils literal notranslate"><span class="pre">--plugins-directory</span></code> flag to CellProfiler.
Defaults to the current v1.0 <code class="docutils literal notranslate"><span class="pre">CellProfiler-plugins/active_plugins</span></code> location for plugins but will revert to the historical location of plugins in the <code class="docutils literal notranslate"><span class="pre">CellProfiler-plugins</span></code> root directory if the <code class="docutils literal notranslate"><span class="pre">active_plugins</span></code> folder is not present.</p></li>
<li><p><strong>UPDATE_PLUGINS:</strong> Whether or not to update the plugins repository before use.
(i.e. run <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">fetch</span> <span class="pre">--all</span></code> on CellProfiler-plugins)</p></li>
<li><p><strong>PLUGINS_COMMIT:</strong> If desired, what commit or version tag to check out.
Used in the <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">PLUGINS_COMMIT</span></code> command in CellProfiler-plugins.
If you do not want to checkout a specific commit, set to False.</p></li>
<li><p><strong>INSTALL_REQUIREMENTS:</strong> Whether or not to install requirements associate with plugins.
Not all plugins require additional requirement installation.
See <a class="reference external" href="https://plugins.cellprofiler.org/using_plugins.html">CellProfiler-plugins Documentation</a> for more information on requirements.</p></li>
<li><p><strong>REQUIREMENTS:</strong> For current v1.0 CellProfiler-plugins, a flag that will be passed to the install command (e.g. <code class="docutils literal notranslate"><span class="pre">cellpose</span></code>).
See <a class="reference external" href="https://plugins.cellprofiler.org/using_plugins.html">CellProfiler-plugins Documentation</a> for more information on supported flags.
For deprecated versions of CellProfiler-plugins before v1.0, pass a path within the CellProfiler-plugins repository to the requirements file you would like to install that will be used in the <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-r</span> <span class="pre">REQUIREMENTS_FILE</span></code> command.</p></li>
</ul>
<p>The <a class="reference external" href="https://hub.docker.com/r/cellprofiler/distributed-cellprofiler/tags">CellProfiler/Distributed-CellProfiler Docker</a> 2.0.0_4.2.4 and older have a clone of the CellProfiler-plugins repository with deprecated organization in them.
If you would like to continue using this clone, set <code class="docutils literal notranslate"><span class="pre">USE_PLUGINS</span> <span class="pre">=</span> <span class="pre">'True'</span></code> and <code class="docutils literal notranslate"><span class="pre">UPDATE_PLUGINS</span> <span class="pre">=</span> <span class="pre">'False'</span></code>.
Note that if you do need to install requirements with the deprecated organization, pass the path to the requirements file within the CellProfiler-plugins repository as <code class="docutils literal notranslate"><span class="pre">REQUIREMENTS</span></code>.
If you would like to update the CellProfiler-plugins repository with up-to-date plugins and new structure while using the CellProfiler/Distributed-CellProfiler Docker 2.0.0_4.2.4 and older, set <code class="docutils literal notranslate"><span class="pre">UPDATE_PLUGINS</span> <span class="pre">=</span> <span class="pre">'True'</span></code>.</p>
<p><a class="reference external" href="https://hub.docker.com/r/cellprofiler/distributed-cellprofiler/tags">CellProfiler/Distributed-CellProfiler Dockers</a> newer than 2.0.0_4.2.4 have current CellProfiler-plugins repository organization.
If you need to use deprecated plugin organization you can access previous commits or version tags by passing them as <code class="docutils literal notranslate"><span class="pre">PLUGINS_COMMIT</span></code>.</p>
</section>
<hr class="docutils" />
<section id="example-configurations">
<h3>EXAMPLE CONFIGURATIONS<a class="headerlink" href="#example-configurations" title="Permalink to this heading">#</a></h3>
<p><img alt="Sample_Distributed-CellProfiler_Configuration_1" src="_images/sample_DCP_config_1.png" /></p>
<p>This is an example of one possible configuration.
It’s a fairly large machine that is able to process 64 jobs at the same time.</p>
<p>The Config settings for this example are:<br />
<strong>TASKS_PER_MACHINE</strong> = 16  (number of Dockers)<br />
<strong>EBS_VOL_SIZE</strong> = 165
<strong>MACHINE_TYPE</strong> = [‘m4.16xlarge’]</p>
<p><strong>DOCKER_CORES</strong> = 4        (copies of CellProfiler to run inside a docker)<br />
<strong>CPU_SHARES</strong> = 4096       (number of cores for each Docker * 1024)<br />
<strong>MEMORY</strong> = 15000          (MB for each Docker)</p>
<p><img alt="Sample_Distributed-CellProfiler_Configuration_2" src="_images/sample_DCP_config_2.png" /></p>
<p>This is an example of another possible configuration.
When we run Distributed CellProfiler we tend to prefer running a larger number of smaller machine.
This is an example of a configuration we often use.
We might use a spot fleet of 100 of these machines (<strong>CLUSTER_MACHINES</strong> = 100).</p>
<p>The Config settings for this example are:<br />
<strong>TASKS_PER_MACHINE</strong> = 1   (number of Dockers)<br />
<strong>EBS_VOL_SIZE</strong> = 22<br />
<strong>MACHINE_TYPE</strong> = [‘m4.xlarge’]</p>
<p><strong>DOCKER_CORES</strong> = 4        (copies of CellProfiler to run inside a docker)<br />
<strong>CPU_SHARES</strong> = 4096       (number of cores for each Docker * 1024)<br />
<strong>MEMORY</strong> = 15000          (MB for each Docker)</p>
</section>
</section>
<div class="toctree-wrapper compound">
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="step_0_prep.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Step 0: Prep</p>
      </div>
    </a>
    <a class="right-next"
       href="config_examples.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">config.py configuration examples</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#components-of-the-config-file">Components of the config file</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#aws-general-settings">AWS GENERAL SETTINGS</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ec2-and-ecs-information">EC2 AND ECS INFORMATION</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#docker-instance-running-environment">DOCKER INSTANCE RUNNING ENVIRONMENT</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sqs-queue-information">SQS QUEUE INFORMATION</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#log-group-information">LOG GROUP INFORMATION</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#monitoring">MONITORING</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cloudwatch-dashboard-creation">CLOUDWATCH DASHBOARD CREATION</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#redundancy-checks">REDUNDANCY CHECKS</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cellprofiler-settings">CELLPROFILER SETTINGS</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plugins">PLUGINS</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-configurations">EXAMPLE CONFIGURATIONS</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Broad Institute
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>